﻿@{
    ViewData["Title"] = "Data Import";
}

<div class="container mt-5">
    <div class="text-center mb-4">
        <h2>Data Import & Sync</h2>
        <div id="syncStatus" class="alert alert-info d-none" role="alert">Database is up to date</div>
    </div>

    <div class="row justify-content-center mb-4">
        <div class="col-md-6 text-center">
            <button id="syncRagic" class="btn btn-primary btn-lg mb-2">Ragic Database Sync</button>
            <div id="ragicSyncTime" class="text-muted">Last Ragic Sync: Never</div>
        </div>
        <div class="col-md-6 text-center">
            <button id="syncGoogle" class="btn btn-info btn-lg mb-2">Google Forms Database Sync</button>
            <div id="googleSyncTime" class="text-muted">Last Google Sync: Never</div>
        </div>
    </div>

    <hr />

    <div class="row justify-content-center mt-4">
        <div class="col-md-4 text-center">
            <button id="deleteAllVeteransBtn" class="btn btn-warning mb-2">Clear All Veterans</button>
        </div>
        <div class="col-md-4 text-center">
            <button id="deleteAllSurveysBtn" class="btn btn-warning mb-2">Clear All Surveys</button>
        </div>
        <div class="col-md-4 text-center">
            <button id="deleteAllEventsBtn" class="btn btn-warning mb-2">Clear All Events</button>
        </div>
    </div>

    <div class="col-md-5 mb-3">
        <button id="clearAzureDb" class="btn btn-danger mb-2">Clear Azure SQL Veterans</button>
        <div id="azureClearStatus" class="text-muted">Last Cleared: Never</div>
    </div>


    <form method="post" action="/data/import">
        <button> Ragic Import Real</button>
        <input name="fileType" value="VeteranData" />
    </form>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        $(document).ready(function () {
            // Load last sync times
            $.get('@Url.Action("GetLastSyncTimes", "Data")', function (data) {
                $('#ragicSyncTime').text('Last Ragic Sync: ' + data.ragic);
                $('#googleSyncTime').text('Last Google Sync: ' + data.google);
            });

            $('#syncRagic').click(function () {
                $.post('@Url.Action("SyncRagicDatabase", "Data")', function (data) {
                    $('#syncStatus').removeClass('d-none').text(data.message);
                    $('#ragicSyncTime').text('Last Ragic Sync: ' + data.lastSync);
                });
            });

            $('#syncGoogle').click(function () {
                $.post('@Url.Action("ImportFromGoogleForms", "Survey")', function (data) {
                    $('#syncStatus').removeClass('d-none').text(data.message);
                    $('#googleSyncTime').text('Last Google Sync: ' + data.lastSync);
                });
            });


            $('#deleteAllSurveysBtn').click(function () {
                if (confirm("Delete ALL surveys?")) {
                    $.post('@Url.Action("DeleteAllSurveys", "Data")', function (data) {
                        alert(data.message);
                    });
                }
            });

            $('#deleteAllVeteransBtn').click(function () {
                if (confirm("Delete ALL veterans?")) {
                    $.post('@Url.Action("DeleteAllVeterans", "Data")', function (data) {
                        alert(data.message);
                    });
                }
            });

            $('#deleteAllEventsBtn').click(function () {
                if (confirm("Delete ALL events?")) {
                    $.post('@Url.Action("DeleteAllEvents", "Data")', function (data) {
                        alert(data.message);
                    });
                }
            });

            $('#clearAzureDb').click(function () {
                $.post('@Url.Action("ClearAzureDatabase", "Data")', function (data) {
                    $('#syncStatus').text(data.message);
                    $('#azureClearStatus').text('Last Cleared: ' + data.lastCleared);
            });
        });

        });
    </script>
}